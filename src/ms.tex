%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%   Please read the CONTRIBUTING.md file in this repository for notes about
%   style and latex conventions!
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[modern]{aastex631}
\usepackage{xspace}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{ulem}

% To allow putting figures in a subdir
\graphicspath{{figures/}}

\submitjournal{ApJ}

\shorttitle{Astropy Project III}
\shortauthors{The Astropy Collaboration}

\input{preamble.tex}

\newcommand{\secauthor}[1]{{\color{blue}Author:~\textit{#1}}}
\newcommand{\secunfilled}{{\color{red}Author:~\textit{Looking for volunteers!}}}

\defcitealias{astropy:2013}{Paper I}
\defcitealias{astropy:2018}{Paper II}


\begin{document}

\draft{\today}

\title{The Astropy Project: \\
       Sustaining and Growing a Community-oriented Open-source Project and
       the Latest Major Release (v5.0) of the Core Package}

\correspondingauthor{Astropy Coordination Committee}
\email{coordinators@astropy.org}

\author{Astropy Collaboration}
\noaffiliation
{\let\thefootnote\relax\footnote{{The author list has two parts: the authors that made significant contributions to the writing of the paper in order of contribution, followed by contributors to the \astropy Project in alphabetical order. \textbf{The position in the author list does not correspond to contributions to the \astropy Project as a whole.} A more complete list of contributors to the core package can be found in the \href{https://github.com/astropy/astropy/graphs/contributors}{package repository}, and at the \href{http://www.astropy.org/team.html}{\astropy team webpage}.}}}

% \input{author.tex}

\begin{abstract}
The \astropy Project supports and fosters the development of open-source and openly-developed
\python packages that provide commonly-needed functionality to the astronomical
community.
A key element of the \astropy Project is the core package \astropypkg, which serves as the
foundation for more specialized projects and packages.
In this article, we summarize key features in the core package as of the recent major
release, version 5.0, and provide major updates for the project.
We then discuss supporting a broader ecosystem of inter-operable packages,
including connections with several astronomical observatories and missions.
We also revisit the future outlook of the \astropy Project and the current
status of Learn Astropy.
We conclude by raising and discussing the current and future challenges facing the project.
\end{abstract}

\keywords{%
    Astrophysics - Instrumentation and Methods for Astrophysics
    ---
    methods: data analysis
    ---
    methods: miscellaneous
}


\section{Introduction} \label{sec:intro}

% \secauthor{Adrian Price-Whelan}

The \python programming language is a high-level, interpreted (as opposed to
compiled) programming language that has become an industry standard across many
computational domains, technological sectors, and fields of research.
This recent and rapid adoption of \python stems from the fact that it enables
scalable, time- and energy-efficient code execution \citep[e.g.,][]{Augier:2021}
with a focus on code readability, ease of use, and interoperability with other
languages.
Over the last decade, \python has grown enormously in popularity to become a
dominant programming language also in the astronomical and broader scientific
communities.
For example, Figure~\ref{fig:python-mentions} shows the number of yearly
full-text mentions of \python as compared to a few other programming languages
in refereed articles in the astronomical literature, demonstrating its nearly
exponential growth in popularity.
The adoption of \python by astronomy researchers, students, observatories, and
technical staff combined with an associated increase in awareness and interest
about open-source software tools is contributing to a paradigm shift in the way
research is done, data is analyzed, and results are shared in astronomy and
beyond.

One of the factors that has led to its rapid ascent in popularity in scientific
contexts has been the significant, volunteer-driven effort behind developing
community-oriented open-source software tools and fostering communities of users
and developers that have grown around these efforts.
Today, a broad and feature-diverse ``ecosystem'' of packages exists in the
\python scientific computing landscape: Roughly ordered from general-use to
domain-specific, this landscape now includes packages that provide core
numerical analysis functionality like \package{numpy} \citep{numpy:nature} and
\package{scipy} \citep{scipy}, visualization frameworks like
\package{matplotlib} \citep{matplotlib}, machine learning and data analysis
packages like \package{tensorflow} \citep{tensorflow}, \package{pymc3}
\citep{Salvatier:2016}, and \package{emcee} \citep{emcee}, domain-specific
libraries like \package{yt} \citep{yt:2011}, \package{plasmapy}
\citep{plasmapy}, \package{sunpy} \citep{sunpy:apj}, \package{Biopython}
\citep{biopython}, and \package{sympy} \citep{sympy} (to name a few in each
category).
The \astropypkg \citep{astropy:2013, astropy:2018} core package began in this
vein, as an effort to consolidate the development of commonly-used functionality
needed to perform astronomical research into a community-developed \python
package.

The \astropypkg core package was one of the first large, open-source \python
packages developed for astronomy and provides, among other things, software
functionality for reading and writing astronomy-specific data formats (e.g.,
FITS), transforming and representing astronomical coordinates, and representing
and propagating physical units in code.
An early description of the core functionality in \astropypkg can be found in
the first \astropy paper \citep{astropy:2013} or in detail in the core package
documentation.\footnote{\url{https://docs.astropy.org/}}
The codebase in the \astropypkg core package is now largely stable, in that the
software interface does not change without sufficient and significant
motivation, and the addition of new features into the core package has slowed
as compared to the first years of its development.
This is largely driven by the fact that the core package now represents just one
piece of the broader astronomy \python context, and much new feature development
is now happening in more specialized packages that are expanding the
capabilities of the \astropy ecosystem by building on top of the foundations
laid by the \astropypkg core package.
Because of this natural expansion, the name \astropy has grown in scope beyond a
single \python library to become ``the Astropy Project.''

\begin{figure}[th]
    \begin{centering}
      \includegraphics[width=\textwidth]{python-mentions.pdf}
        \caption{
            Yearly full-text mentions of programming languages (indicated in the
            figure legend) in refereed publications in the astronomical
            literature database in the Astrophysics Data System (ADS).
            \python has rapidly become the dominant programming language
            mentioned in refereed articles over the last 10 years.
        }
        \label{fig:python-mentions}
    \end{centering}
\end{figure}

The \astropy Project is a community effort that represents the union of the
\astropypkg core package, the ecosystem of astronomy-specific software tools
that are interoperable with \astropypkg (Astropy Affiliated Packages),
\emph{and} the community of users, developers, and maintainers that participate
in Astropy efforts.
However, there is no institution responsible for managing the Astropy Project,
for funding or maintaining its development, or sustaining it into the future:
The Project is maintained and coordinated largely by volunteers.
While new Astropy-affiliated packages are being developed that expand upon the
core functionality in the \astropypkg package, representing a natural expansion
of the Astropy Project ecosystem, the needs of and challenges faced by the
Project are evolving.
In particular, the transition from focusing our energy on development and
maintenance of a single core package, to instead sustaining the core package and
fostering the development of the community and its expansion has been a key
issue faced by the Astropy Project in the last several years.

In this Article, we briefly describe recent key updates in the \astropypkg core
package since the last Astropy paper (``Paper II''; \citealt{astropy:2018}),
major updates in the governance, contributor base, and funding of the Project,
and discuss some of the future plans and challenges faced by the Astropy
Project.


\section{Major Updates to the Astropy Core Package} \label{sec:core-updates}

\subsection{New Long-term Support (LTS) Version: v5.0} \label{sec:core-v50}

% \secauthor{Tom Robitaille}

Major versions of the core package --- that is, versions that add and/or modify
functionality --- are released approximately every six months, and are then
maintained with releases that fix issues until the next major version is
released. However, every two years a major release is designated as a long-term
support (LTS) release, which continues to be maintained for up to two years
\citep{ape2}. The motivation for LTS releases is to provide longer-term stable
versions of \astropypkg that users that require a high level of stability can
make use of if they do not always need the latest features (this could include,
for example, telescope operation or data reduction pipelines, etc.). The v5.0
release of the core package was designated as LTS, and since it was released at
the end of 2021, it will be maintained until the end of 2023.


\subsection{Highlighted Feature Development} \label{sec:core-features}

% \secauthor{Nathaniel Starkman, Marten van Kerkwijk}

The \astropypkg core package is mature and stable, in that many features have
been part of the core package for years with purposefully few changes to the
software interface. This maturity and stability allows for the broader
astronomy \python community to rely upon the \astropypkg core package and build
specialized packages within the Astropy ecosystem. Even many non-astronomical
\python libraries have come to rely on \astropypkg. The relationship between
\astropy and the \python-using community is reciprocal, with the evolving needs
of the community and the maturation of the broader scientific \python ecosystem
driving much of the development of the \astropypkg core package.

Within \astropypkg, development may be roughly split into a few
categories: new features added, intra- and inter-package interoperability,
improvements to precision, accuracy, and reproducibility, and performance
enhancements. We discuss these in the subsections below.

Additionally, some features have been moved from the core package, either
because they are of more general use outside of \astropypkg, or because they are
too specialized and belong in an Astropy-affiliated package. An example of the
former is the copy of the IAU Standards Of Fundamental Astronomy (SOFA) software
Collection\footnote{\url{http://www.iausofa.org}} \citep{sofa} that \astropy
carried, as well as the \python wrappers for it. Since this is basic
infrastructure, with a release cycle set by SOFA, it made more sense to create
separate packages that serve as \astropypkg dependencies: \package{ERFA}
\citep{erfa} and \package{PyERFA} \citep{pyerfa}. An example of something that
was too specialized was a Virtual Observatory sub-package; the Simple
Application Message Protocol was kept in the core package
(\astropysubpkg{samp}), but other parts more properly belonged in
\package{astroquery} (see Section~\ref{sec:astroquery}).


\subsubsection{New and Planned Features} \label{sec:core-features-new}

New features present a particular difficulty for a mature package such as
\astropypkg, because it is difficult to know {\em a priori} what the best
interface will be, and hard to address all possible use cases in one round of
development, even within \astropypkg\ itself. New features come in various forms,
from new submodules providing wholly new capabilities, to larger additions to
existing submodules, to large rewrites of the interface of modules. This range
is spanned by five main new features that entered the \astropypkg core since the
previous summary \citepalias{astropy:2018}. In our descriptions of each we
include how we hope the new feature will evolve. Ultimately, in a user-driven
project like \astropy, development depends primarily on the priorities of
contributors.

\paragraph{Uncertainties and Distributions} Early in our careers we were likely
all taught that measurements without units and uncertainties are meaningless.
\astropyunits provides the ability to associate numbers with units, and
propagate these correctly, using the \astropyQuantity\ class. However, the
ability to associate and propagate uncertainties is relatively limited: in
\astropysubpkg{nddata}, there are options to associate errors with data arrays,
but these are treated as independent, i.e., covariances are not tracked.

Error propagation is difficult, and often is best approximated using Monte Carlo
methods. The new \astropysubpkg{uncertainties} sub-package is our first step
towards enabling seamless error propagation. The package allows one to
generate, for each variable, randomly drawn samples in a \astropyDistribution,
and then propagate these by passing them through the normal analysis, producing
a \astropyDistribution\ of final results that can be inspected. This
\astropyDistribution\ can be any type of array, including a \astropyQuantity.
The goal is to ensure \astropyDistribution\ can be seamlessly used to
instantiate other \astropypkg classes as well, such as \astropySkyCoord,
\astropyTime, and \astropyCosmology.

A plan for future development of \astropysubpkg{uncertainties} is to also
support error propagation, tracking covariances, for the case that uncertainties
are normally distributed rather than approximated by Monte-Carlo means. One
implementation problem to be solved is when to {\em stop} tracking covariances.
For instance, a simple operation such as subtracting the mean from $N$ data
points implies that all data points are now covariant with each other, i.e., one
has to carry $N\times N$ covariances. For a large image, that becomes not just
pointless but also prohibitive in terms of memory and CPU usage.

\paragraph{Masked quantities}  It can be useful to mask bad data. How one
supports masked data involves a number of choices, such as whether one indicates
data values are bad by a separate flag or by replacing bad data with a special
value, such as ``Not a Number'' (NaN). In \astropypkg, both approaches have
been used: a flag for masked columns in \astropyTable, mask flags and bitmaps
for N-dimensional data in \astropysubpkg{nddata}, and replacing elements with
NaN in \astropyTime. However masked quantities were poorly supported, making it
difficult to use masks in a \astropyQTable\ (in which \astropyQuantity\ is used
for all columns with units).

Unfortunately, the \texttt{MaskedArray} class from \package{numpy} only works
well with plain data arrays, hiding other metadata and attributes, for example
the \texttt{unit} of a \astropyQuantity. Consequently, a new \astropyMasked\
class was designed, based on a framework very similar to that of
\astropyDistribution, making it easy to create masked instances of other
classes. In particular, \astropyMasked\ can be used to create masked quantities
for \astropyQTable, enabling I/O of masked data from different file types.

The masked quantities work largely without any changes in higher-level objects
such as \astropySkyCoord, but work is still underway to expose the mask in those
classes, as well as to use masked arrays in \astropyTime\ instead of replacing
data with NaN.

\paragraph{Time series}  From sampling a continuous variable at fixed times to
counting events binned into time windows, many different areas of astrophysics
require the manipulation of time series. The new \astropysubpkg{timeseries}
sub-package extends the \astropyQTable\ class to support tables of data as a
function of time, where the data can either represent samples or averages over
particular time bins. The new classes offer a number of special methods to
manipulate time series (folding, resampling, etc.) and to read different data
formats (such as \mission{Kepler} light curves, etc.).

Also part of \astropysubpkg{timeseries} are common analysis routines, including
\href{https://docs.astropy.org/en/stable/timeseries/lombscargle.html}{Lomb-Scargle}
and
\href{https://docs.astropy.org/en/stable/timeseries/bls.html}{box-least-squares}
periodograms.

\paragraph{Spectral Coordinates} Measurements are often taken at specific
``spectral coordinates,'' be they frequencies, wavelengths, or photon energies.
\astropyQuantity\ can represent these and convert between them via dedicated
equivalencies. The new \astropySpectralCoord\ builds on \astropyQuantity\ by
providing a more straightforward interface: baking in these equivalencies and
those for Doppler velocities. Furthermore, \astropySpectralCoord\ can be made
aware of the observer and target reference frames, allowing transformation from
telescope-centric (or topocentric) frames to Barycentric or Local Standard of
Rest (LSRK and LSRD) velocity frames.

\paragraph{A High-Level Interface to World Coordinate Systems}
Astronomical data are often provided alongside information about the
correspondence between ``real-world'' and pixel coordinates. This mapping is the
essence of the ``World Coordinate System (WCS)'' concept. From its inception,
the \astropysubpkg{wcs} sub-package allowed access to WCS information provided
in, e.g., FITS files, but it became clear that other WCS standards and
representations had to be supported for new missions and observatories (e.g.,
the James Webb Space Telescope and the Rubin Observatory). To harmonize these
needs, a new high-level interface was created based on a formal design first
proposed in an \astropy\ Proposal for Enhancement (\astropyAPE{14}). The hope is
that by having a formal design, other packages implementing WCS objects can
straightforwardly modify their classes to conform to the new interface or build
thin wrappers that conform. The implementation in \astropysubpkg{wcs} interacts
well with other \astropypkg\ objects such as \astropySkyCoord\ and \astropyTime.

\subsubsection{Interoperability} \label{sec:core-features-interoperability}

Because \astropy is modular and situated at the nexus between scientific
computing and astronomy, interoperability is an important focus for \astropy,
both within the various \astropypkg sub-packages and with other \python
libraries. If done right, all a person notices is that code using many different
python features and libraries ``just works.'' Here, we describe a few particular
efforts towards this goal.

\paragraph{\package{numpy} on Units}

\astropyQuantity\ is a backbone of \astropy, leveraging the power of
\package{numpy} and adding units. Previously, many \package{numpy} functions
would strip a \astropyQuantity\ of its units (or fail outright), limiting
\astropyQuantity's usefulness. Now, advances in \package{numpy} function
overloading (e.g.,
\href{https://numpy.org/neps/nep-0018-array-function-protocol.html}{NEP 18})
mean \astropyQuantity\ works with almost all \package{numpy} (v1.17+)
functions.

In the remaining gaps, the \package{numpy} and \astropyQuantity\
interoperability efforts are ongoing. For some functions, such as in
\href{https://numpy.org/doc/stable/user/basics.rec.html#module-numpy.lib.recfunctions}{\package{numpy}'s
module} for manipulating structured arrays, compatibility only requires
extending the existing \package{numpy}-\astropypkg bridge frameworks. Community
interest, in the form of a Feature Request (or better yet Pull Request) would be
sufficient to see this compatibility completed. For a few remaining functions,
discussed further in the
\href{https://docs.astropy.org/en/stable/known_issues.html#known-deficiencies}{\astropy
documentation}, the \package{numpy} framework does not yet allow for full
interoperability with \astropy. A goal of \astropy and the scientific \python
community is to enhance and implement the frameworks, allowing \astropyQuantity\
to propagate units seamlessly across the whole ecosystem of \package{numpy}-like
projects.

\paragraph{\astropypkg on Units}

Units were also integrated further within \astropypkg. For an already-defined unit-less
\astropyModel, e.g. those imported from another library, \astropymodeling can
now coerce units.
% TODO! transition words
A new module – \astropycosmologyunits – has been added to the cosmology
sub-package for defining and collecting cosmological units and equivalencies.
The unit \texttt{littleh} and equivalency
\astropyapidoc{cosmology.units.with_H0}{with\_H0} was moved from the main
\astropyunits sub-package to \astropycosmologyunits. A new unit,
\texttt{redshift}, has been added for tracking factors of cosmological redshift.
To correctly use redshift units in dimensional analysis, \texttt{redshift} is
\astropyapi{cosmology.units.dimensionless_redshift}{treated as dimensionless}
by default. To convert between redshift and other cosmological distance
measures, e.g. CMB temperature or comoving distance, the equivalency
\astropyapidoc{cosmology.units.with_redshift}{with\_redshift}
has also been added. This equivalency is actually a composite of other equivalencies,
which may be used separately.

\paragraph{Table Mixin Columns}

Within \astropypkg and \python there are numerous ways to represent and store
array-valued data. Some of the differences are historical:
\astropyapidoc{table.Column}{table.Column} and
\astropyapidoc{io.fits.Column}{io.fits.Column} are not the same. Some
differences are computational: \package{numpy}, \package{cupy}, and
\package{dask} arrays have almost identical APIs, but are optimized for
different use cases. Lastly, some differences are inherent: \astropyQuantity,
\astropyTime\, and \astropySkyCoord\ represent fundamentally different types of
objects.

We aim to make it possible for any array-valued data to be used as a column in a
table. A well defined protocol for mixin-columns has been developed for
\astropytable, allowing the original object to be used as a column with a
familiar API, and to ``round-trip'' through tables with no loss of data or
attributes. With this protocol, it is now possible to store \astropy native
objects -- including \astropyTime, \astropyQuantity, and \astropySkyCoord --
within a \astropyTable\ and write these to various file formats, such as FITS.
For objects not already covered by the mixin protocol, functions can be
registered with \astropyTable\ to convert any array-like object into a mixin
column. As an example, the mixin functions are used to integrate \package{dask}
arrays with \astropyTable, allowing cloud-stored or cluster-scale data to be
used as a column in a \astropyTable.

\paragraph{Astropy FITS in Time}

The FITS standard was extended to rigorously describe time coordinates in the
World Coordinate System (WCS) framework \citep{FITS-Time:2015}. Compared to
other types of coordinates in WCS, time requires more metadata: format, scale,
position, reference, etc. This metadata had to be manually specified and the
nuances understood by the user. \astropyfits could read this data as a standard
\astropyFitsColumn\, but would not interpret the time-related metadata and
attributes. Through the support of the
\href{https://summerofcode.withgoogle.com/archive/2017/projects/4778482366152704}{Google
Summer of Code} 2017 program,\footnote{ To learn more about this project, please
see the final report
\href{https://aaryapatil.wordpress.com/2017/08/28/a-mixin-protocol-for-seamless-interoperability/}{A
mixin protocol for seamless interoperability}.}, the \astropyfits package now
interprets time data correctly, using \astropyTime\ as a `mixin' column. For
backward compatibility with manual systems, this feature may be turned off.

\paragraph{Persistent Storage}

\astropy's efforts to increase support for column types in a table is mirrored
by efforts to expand storage format options. New formats have been added, and
existing formats updated to support more column types.

\astropy now supports reading and writing tables in the American Astronomical
Society Journals' Machine-Readable Table (MRT) format. This ASCII format has
long been missing and as added in this year's Google Summer of Code project adds
\href{https://docs.astropy.org/en/stable/io/ascii/write.html#cds-mrt-format}{MRT}
to \astropyTable\ I/O. In addition, \astropyTable\ may also read from and write
to \href{https://asdf-standard.readthedocs.io/en/latest/}{ASDF},
\href{https://docs.astropy.org/en/stable/io/unified.html#table-io-parquet}{Parquet},
and \href{https://wwwastro.msfc.nasa.gov/qdp/}{QDP} formats.

The \href{https://github.com/astropy/astropy-APEs/blob/main/APE6.rst}{ECSV
standard} has been updated to version 1.0, adding support three additional data
subtypes. First, it adds multidimensional column data (both masked and unmasked)
with fixed dimensions in all table cells. Second, it adds multidimensional
column data with variable-dimension arrays similar to FITS variable-length
arrays. Third, it adds object-type columns with simple \python objects.

As mentioned previously, \package{dask} arrays may be used as a mixin column in
\astropyTable. Now, \package{dask} may also be the data array in
\astropyapidoc{io.fits.PrimaryHDU}{FITS HDU} and if written to disk, the array
will be computed while written, avoiding excessive memory use. \astropyTable\ can
now be appended to an existing FITS file, and \package{dask} mixin columns
interoperate seamlessly between the two table types.

\paragraph{Unified I/O architecture}

\astropyiosubpkg{registry} is a powerful way to define input and output (I/O)
functions for \astropypkg objects, such as reading from or writing to a file,
following a given standard. \astropy uses this internally for the I/O methods in
\astropyTable\ and \astropyCosmology, and users can register custom I/O to
extend the options on these classes.

As of Astropy 5.0, the I/O registry submodule has been generalized to enable a
number of new use cases. for instance, the class-based architecture allows for
the creation of custom registries. One application is in \astropycosmology,
which has two different \textit{kinds} of registries for \astropyCosmology: one
for reading and writing files, and another for converting between python
objects. Using \astropyiosubpkg{registry} for custom classes means a developer
does not have to create a whole new I/O system and can offer to the user a
unified and familiar API.


\subsection{Precision, Accuracy, \& Reproducibility}
\label{sec:core-features-precision_accuracy_repreducibility}

An important focus of \astropy has been to increase the precision and accuracy
of its functionality, while, where appropriate, making sure results obtained
using older versions of \astropypkg are reproducible. Within each section below
we include in our descriptions how old results may be reproduced. The primary
means are with options in configuration files and settings on runtime configuration
objects called \astropyScienceState. Notable improvements to \astropypkg have
been made to \astropytime, \astropyconstants, \astropycoordinates, and
\astropycosmology, and we describe each in turn.

\paragraph{Time}
In astronomy, time accuracy down to the (nano)second is frequently important.
Whether for planning observations, crunching pulsar or VLBI data, missing
seconds meaningfully impact results. In past versions of \astropypkg, when using
\astropyTime\ in \astropytime leap seconds had to be manually applied; now, leap
seconds are applied automatically. Moreover, \astropypkg updates internal time
data-files to ensure that the correct leap second adjustment is always used. For
reproducibility, e.g., with an old code, \astropyLeapSeconds\ may also be
manually applied.

\paragraph{Constants}

Measurements of physical constants (and the units defined from them) improve
over time. Periodically the standardized systems of units and constants are
updated to reflect these improvements. For instance, in 2019 the SI system was
redefined \citep{NIST2019}, with an accompanying update to the physical
constants in
\href{https://codata.org/initiatives/data-science-and-stewardship/fundamental-physical-constants/}{\texttt{SI/CODATA
2018}}. \astropyconstants now defaults to use the \texttt{SI/CODATA 2018}
values, with the units in \astropyunits based on these constants. Most of
\astropypkg and affiliate packages build upon \astropyunits, so this update
effects the entire \astropy ecosystem.

For reproducibility, \astropypkg allows the constants' (and therefore units')
definitions to be rolled back to prior values, e.g., to the \texttt{SI/CODATA
2014} values. For work sensitive to the values of the fundamental constants we
recommend including an \astropy configuration file with the work, which
specifies the set of constants used.

\paragraph{Cosmology}

\astropycosmology contains classes for representing cosmological models. Bundled
with the classes are commonly used \astropyCosmology\ realizations, e.g.,
best-fit measurements from
\href{https://lambda.gsfc.nasa.gov/product/map/current/}{WMAP}
\citep{WMAP2003} and
\href{https://www.nasa.gov/mission_pages/planck}{Planck}
\citep{PlanckMission:2006}.

When these important missions publish new measurements, \astropycosmology is
updated to include these results as realizations of the appropriate class
(generally \astropyFlatLambdaCDM). The models used by WMAP and Planck do not
always exactly correspond to \astropycosmology classes. For instance, the Planck
2018 results \citep{Planck2018VI:2020} include massive neutrinos in
$\Omega_{matter,0}$, while in \astropyFlatLambdaCDM\ this mass contribution is
stored in a separate parameter. Consequently, while some parameter values appear
different from the source paper, the \astropyCosmology\ realizations correctly
reproduce the cosmological models.

Since \citet{astropy:2018}, the following cosmology realizations have been
added:
\href{http://docs.astropy.org/en/stable/api/astropy.cosmology.WMAP1.html}{WMAP First Year}
\citep{WMAP1Year:2003};
\href{http://docs.astropy.org/en/stable/api/astropy.cosmology.WMAP3.html}{WMAP
Three Year} \citep{WMAP3Year:2007};
\href{http://docs.astropy.org/en/stable/api/astropy.cosmology.Planck15.html}{Planck 2015}
\citep{Planck2015XIII:2016}; and the
\href{http://docs.astropy.org/en/stable/api/astropy.cosmology.Planck18.html}{Planck
2018} best-fit cosmological parameters \citep{Planck2018VI:2020}.

Astropy provides a
\href{http://docs.astropy.org/en/stable/api/astropy.cosmology.default_cosmology.html}{configurable
default cosmology}, which is used in calculations done in a cosmological
context. The default \astropyCosmology\ has been updated to the Planck 2018
parameters. For reproducibility, this cosmology may be set to old defaults, such
as the WMAP Three Year values. The default cosmology is dynamically configurable
using \astropyScienceState, meaning a set of calculations may be run using
different assumed cosmologies, and results compared between the two.

\paragraph{Coordinates}

Being able to describe the position of objects, i.e., their coordinates, is
fundamental across many knowledge domains. \astropycoordinates allows one to
work with low-level positional and velocity data all the way to high-level
coordinate objects with reference frames, atmospheric information, and more. A
central feature of \astropycoordinates is the ability to transform data between
reference frames, e.g., \astropyICRS\ \citep{ICRS:1997} to \astropyGalacticLSR\
\citep{GalacticLSR:2010}. However, there have been some historical limitations
for spatially proximate transformations, impacting the usefulness of
\astropycoordinates for ground-based telescopes and astrometry within the
solar system. Transformations in the \astropyAltAz\ frame were reasonably
precise for very distant objects, but wrong by up to several arcseconds for
e.g., the location of the moon. Now these transformations are much more precise,
down to the milliarcsecond level. Similar precision improvements were made to
the
\astropyapi{coordinates.builtin_frames.HADec}{Hour Angle-Declination}
frame transformations. Additionally,
\astropyapi{coordinates.builtin_frames.BaseEclipticFrame}{Ecliptic frames}
and associated transformations have been updated to correctly reflect the “true”
and “mean” terminology.

For Galactic astronomers, the \astropyGalactocentric\
\astropyapi{coordinates.galactocentric_frame_defaults}{frame defaults}
have been updated to include more recent measurements (tabulated in the
\href{https://docs.astropy.org/en/stable/api/astropy.coordinates.galactocentric_frame_defaults.html#astropy.coordinates.galactocentric_frame_defaults.references}{\texttt{frame\_defaults.references}}
attribute). For reproducibility, old definitions are still available.


\subsection{Performance} \label{sec:core-features-performance}

As features are added and corner cases dealt with, performance often suffers.
Hence, pull requests that improve performance are welcomed, and were even the
main goal for one release cycle. For most sub-packages, performance was
improved in the \python\ code, but for some, the most time-critical pieces were
rewritten in~C (e.g., for convolution of images, sigma-clipping, and converting
time strings to binary). Furthermore, a particular effort was made to ensure
\astropypkg\ is thread-safe, so that it can be used on supercomputer clusters.

Performance in \astropypkg is addressed based on feedback and requests, and
through contributions from community members: If you find that parts of
\astropypkg are not performant, we encourage you to open a \github issue to
start a discussion with the \astropypkg core maintainers.


\section{Major Updates in the Astropy Project} \label{sec:project-updates}

\subsection{Project governance} \label{sec:project-governance}

% \secauthor{Erik Tollerud}

%Briefly summarize new procedures and governance structure, new CoCo, election
%process overview, etc.

As part of the process of developing \astropypkg into a long-term sustainable
product, and to improve transparency and accountability, the Project agreed to
write down and formalize our governance structure (partly supported by explicit
funding for this purpose; see Section~\ref{sec:project-funding}). At the 2019
Astropy Coordination Meeting, input was gathered from participants on what governance
structures existed in the associated Open Source Software communities, and what
would fit well with the needs of \astropy. This led into a ``retreat'' planned
for March 2020, but due to the COVID-19 pandemic, this became a series of
virtual meetings of the ``Astropy Governance Working Group.'' This group
drafted the APE 0 document \citep{ape0}, which was then eventually ratified and
implemented by the ``Astropy Governance Implementation Working Group'' in Fall
2021. While the process emphasized flexibility and the ability to adapt to
changing circumstances, it is expected that this is the framework Astropy's
governance will operate in for at least the medium-term future.

The APE0 \citep{ape0} document lays out the principles of this governance
structure, so we refer the reader to that document for a more thorough
description, and here we only highlight some key elements. While many of these
principles were already de facto true or have been discussed organically (and
have been discussed in earlier papers in this series), the APE0-based governance
aims to provide a single place where the community can agree as a starting
point. With this in mind, it highlights the developer and user community of the
Astropy Project as the ultimate sources of authority, as well as the core
principle of ``do-ocracy'' that those who do work for the Project (be it coding,
training, or other harder-to-quantify contributions) gain more influence on the
outputs of the Project by virtue of their effort. However, APE0 adds the
concept of ``voting members'': a self-governed part of that community who are
entrusted to elect the Coordination Committee (CoCo). While the CoCo has existed
from the inception of the project, APE0 establishes a formal voting process for
CoCo members, and explicitly outlines the rights and responsibilities of the
CoCo. This role is mainly to facilitate consensus and act as the decision maker
when other mechanisms have failed, and includes powers that either
require central authority or secrets (e.g., passwords) However, APE0 also
charges the Committee to devolve responsibilities and seek community input on
these items as often as possible.

The first Coordination Committee election under these rules took place in Fall
2021, electing a mix of prior and new coordination committee members,
and was contested in the sense of more candidates than available slots. This
suggests the process is already working to serve the long-term interests of the
committee to both spread the coordination effort, and to ensure it is not
dominated by the same people for as long as the Project continues. While other,
more fine-grained governance improvements are planned for the future, it is
clear the foundation is now in place.


\subsection{Contributor base} \label{sec:project-contributors}

\secauthor{Adrian Price-Whelan}

Overview and statistics of contributors. Highlight changes since v2.0.

\begin{figure}
    \begin{centering}
      % \includegraphics{figures/contributor-summary.pdf}
        \caption{Placeholder figure!}
        \label{fig:contributor-summary}
    \end{centering}
\end{figure}

% Transition of needs: From new features, to community development, sustainability, ...
% - pipeline between User, Participant, Code contributor, Maintainer, Coordinator.

\subsection{Inclusion, Diversity, and Equity Programs} \label{sec:project-ide}

% \secauthor{Lía Corrales}

With support from the Moore Foundation, the \astropy Project was
allocated funding to support mentoring programs. In 2020 a call was
made to submit proposals for IDE (Inclusion, Diversity, and
Empowerment) initiatives for project-wide consideration on
Github. This process was deemed the most ``open'' because it allowed
for community-wide feedback to focus and improve proposal
initiatives. Two highlighted programs that were selected and implemented via
this process are described below.

% \textbf{Outreachy:} \todo{No author assigned}{Describe the outreachy project}

\textbf{Women of Color Code (WoCCode)} is a peer-mentoring network for
coders from traditionally marginalized groups, most notably women of
color. Participants were invited to the WoCCode Slack space and
encouraged to attend monthly webinars to share skills in the context
of open source software libraries. Every other month, a guest speaker
was invited to talk about their career path and share a skill. Program
participants were solicited in the fall of 2020, yielding 73
applications from 17 countries (48\% from the United States, 37\% from
Africa, and 15\% from remaining continents). We selected participants
who we identified as having a high potential for contributing to open
source projects: intermediate to advanced programming skills with a
vocal interest in contributing. Of the thirty applicants invited to
the program, nineteen joined the community on Slack. Participants were
organized into cohorts based on interest and each cohort was assigned
one of three mentors that were also selected via open
application. Mentors acted as a general resource to participants, gave
one webinar, and organized a hack day. WoCCode also supported
registration of two participants to attend the American Astronomical
Society virtual summer 2021 meeting.

Participants rated the impact of the program as very high. In the
final webinar, participants reported a change in their perception of
coding in general, for example, accepting coding as something they can
do for fun. Participants reported generally feeling comfortable asking
questions and interacting with a community where ``[e]veryone's
thoughts are welcomed, no one is made to feel less important'' and
where one can enjoy ``warm interactions with likeminded people.''
WoCCode is continuing into 2022 by broadening participation in the
Slack space and publicly advertising the guest webinar events.

In addition to the supported mentoring initiatives, the \astropy
project as a whole has taken steps to examine representation of
marginalized groups within the project and search for avenues of
improvement.

% Much of this text was adapted from Robel Geda's report from NSBP and
% SACNAS. Please include him on the author list.
\textbf{\astropy representation at national diversity conferences:}
Several members of the \astropy community attended virtual conferences of the
National Society of Black Physicists (NSBP) and SACNAS (focusing on Hispanic and
Native American scientists across all STEM fields). \astropy representatives
noted that one underlying topic came up multiple times. A major barrier for
persons who come from underrepresented communities is the lack of resources and
expertise that are necessary to train students. Writing PEP 8 compliant software
and understanding the Git and \github workflow is not part of the standard
Physics and Astrophysics curriculum. Additionally, the larger astronomical
community is still in the process of transitioning towards \python-based tools,
making it difficult for students not currently under advisement by some one with
extensive \python expertise to get involved with the open source \python
community. Projects such as Learn Astropy (see Section~\ref{sec:learn}) could
have a profound impact by empowering underrepresented groups because it provides
a free, searchable, and accessible introduction to \python tools for
astrophysical research. Representatives also noted that offering training and
teaching materials to PIs of Research Experience for Undergraduate (REU)
programs throughout the United States could be helpful for encouraging advisors
to teach students how to use Astropy, create their own libraries, and use
version control on open source platforms like \github. Such materials could also
be offered as a workshop at national diversity conferences themselves, as SACNAS
solicits special session proposals each year.

% \textbf{NumFOCUS ``Contributor Diversification \& Retention'' (CDR)
%   initiative:} \todo{No author assigned}{Describe more about this.}


\subsection{Project funding} \label{sec:project-funding}

% \secauthor{Aarya Patil}

% Summarize funding sources (Moore, NASA) and amounts and what this has been
% used for.

With the goal of establishing a sustainable financial model for the Astropy
Project, the Coordination Committee, under the new governance charter (see
Section~\ref{sec:project-governance}), established a standing Finance Committee.
This committee oversees the planning and allocation of finances on behalf
of the Project. The Astropy Project accepts funds from institutions as well as
individuals through NumFOCUS.\footnote{NumFOCUS is a 501(c)(3) nonprofit that
supports and promotes world-class, innovative, open source scientific computing.}
Previously, no direct financial support was available for the project development,
and NumFOCUS covered most of the incurred operational costs. However, transitioning
to long-term financial stability meant having an influx of funds in the form of
institutional support, and hence the Astropy Project applied for and successfully
acquired four grants over the last several years. These grants are administered by NumFOCUS on behalf of the
Project, providing a ``neutral'' space not tied to any particular astronomy
institution. The two major grants are briefly summarized below.

\begin{description}
    \item[Moore] The Gordon and Betty Moore Foundation awarded the Astropy
    project a $\sim$\$900k (US) grant in 2019 for the proposal ``Sustaining and
    Growing the Astropy Project.'' Over a three-year term, this grant supported
    sustenance of the Project by providing funds for (1) the development and
    maintenance of the \astropypkg and its infrastructure, provided to existing
    project members and targeted hires, (2) the transition of long-term users to
    contributors and maintainers through mentorship efforts, (3) the
    formalization of a governance structure (see
    Section~\ref{sec:project-governance}), and (4) the improvement of equity,
    diversity, and inclusion efforts in the project (see
    Section~\ref{sec:project-ide}). Some of this money supported travel for
    meetings, conferences, and workshops. This generous grant helped reduce
    reliance on volunteer-driven maintenance of the openly-developed package and
    paved the way to acquire funding from federal agencies, representing a major
    milestone for the success of the project.

    \item[NASA] A successful proposal to the NASA ROSES-2020
    call\footnote{http://solicitation.nasaprs.com/ROSES2020}, section E.7
    (Support for Open Source Tools, Frameworks, and Libraries), granted the
    Astropy Project $\sim$\$600k (US) to support its work. Funded work for a
    term of three years includes (1) project-wide infrastructure maintenance and
    improvements, (2) targeted work on areas of the \astropy core and
    coordinated packages, (3) enhancements to the Learn
    Astropy ecosystem and educational materials (see Section~\ref{sec:learn}),
    and (4) support for the \astropy affiliated packages. These goals
    support the sustenance of the project by encouraging further
    development of the package ecosystem and community engagement.
\end{description}

In addition to the two grants described above, the project benefited from
a Gemini Observatory contract under its Science User Support Department,
which awarded funds for development work that supports both the Astropy and
DRAGONS projects. The project also received financial support from the Dunlap
Seed Funding program at the University of Toronto to develop educational
resources for scientific software packaging within the Learn Astropy
framework. All of these successful proposals show that the Astropy Project
is vital for the astronomical infrastructure and community at large, and
strengthen its promising and sustainable future.

% ADD text for the new finance APE once it has a doi

\section{Supporting the Ecosystem of Astronomical Python Software}
\label{sec:ecosystem}

\subsection{Community-oriented infrastructure}

% \secauthor{Nicholas Earl}

The Astropy project supports the broader ecosystem by providing pre-configured
infrastructure packages that the community can use to support and maintain their
own software package infrastructure. These include tools and extensions that
enable easily generating documentation and setting up automated testing, as well
as providing package scaffolding for new projects.

Sphinx is a common and useful tool for generating documentation for Python
packages. The Astropy project maintains a default Sphinx configuration along
with Astropy-specific extensions that can be easily added to community
projects via the
\href{https://github.com/astropy/sphinx-astropy}{\texttt{sphinx-astropy}} meta
package. This tool provides a pre-configured Sphinx setup compatible with
Astropy projects, which includes several extensions useful for generating API
documentation
(\href{https://github.com/astropy/sphinx-automodapi}{\texttt{sphinx-automodapi}}),
allowing for Numpy docstring parsing
(\href{https://github.com/numpy/numpydoc}{\texttt{numpydoc}}), embedded image
handling
(\href{https://github.com/sphinx-gallery/sphinx-gallery}{\texttt{sphinx-gallery}};
\href{https://github.com/python-pillow}{\texttt{pillow}}), advanced
documentation testing support
(\href{https://github.com/astropy/pytest-doctestplus}{\texttt{pytest-doctestplus}}),
and providing a custom documentation theme ideal for analysis packages
(\href{https://github.com/astropy/sphinx-astropy}{\texttt{astropy-sphinx-theme}}).

Community package testing infrastructure is supported through the
\href{https://github.com/astropy/pytest-astropy}{\texttt{pytest-astropy}}
meta-package, providing a unified testing framework with useful extensions
compatible with both Astropy- and non-Astropy-affiliated community packages.
This meta-package pulls in several
\href{https://github.com/pytest-dev/pytest}{\texttt{pytest}} plugins to help
with custom test headers
(\href{https://github.com/astropy/pytest-astropy-header}{\texttt{pytest-astropy-header}}),
accessing remotely-hosted data files in tests
(\href{https://github.com/astropy/pytest-remotedata}{\texttt{pytest-remotedata}}),
interoperability with documentation
(\href{https://github.com/astropy/pytest-doctestplus}{\texttt{pytest-doctestplus}}),
dangling file handle checking
(\href{https://github.com/astropy/pytest-openfiles}{\texttt{pytest-openfiles}}),
data array comparison support in tests
(\href{https://github.com/astropy/pytest-arraydiff}{\texttt{pytest-arraydiff}}),
sub-package command-line testing support
(\href{https://github.com/astropy/pytest-filter-subpackage}{\texttt{pytest-filter-subpackage}}),
improved mock object testing
(\href{https://github.com/pytest-dev/pytest-mock}{\texttt{pytest-mock}}), test
coverage reports and measurements
(\href{https://github.com/pytest-dev/pytest-cov}{\texttt{pytest-cov}}), and
configuring packages for property-based testing
(\href{https://github.com/HypothesisWorks/hypothesis}{\texttt{hypothesis}}).

The Astropy Package Template helps facilitate the setup and creation of new
Python packages leveraging the Astropy ecosystem. This tool utilizes the
Cookiecutter project to walk users through the process of creating new
packages complete with documentation and testing support. Additionally, the
package template generation process includes the ability to setup
interoperability with \github, allowing for easy repository access from
documentation, as well as an example \github Actions workflow to demonstrate
the use of \github's continuous integration tooling.

\subsection{Astropy affiliated packages}

% \secauthor{Matt Craig, Brett Morris}

% Highlight a few new affiliated packages and major updates to existing ones.
% Include a big table of all affiliated packages and references (as in v2.0
% paper).

As defined in \paperii, Astropy affiliated packages are astronomy-related
\python packages that provide functionality that builds upon and extends the
\astropypkg core package that have requested to be included as part of the
Astropy Project community. These packages support the goals and vision of
Astropy of improving code re-use, interoperability, and embracing good coding
practices such as testing and thorough documentation.
All Astropy-coordinated and other affiliated packages are listed with detailed
information on the \href{{https://www.astropy.org/affiliated}}{\astropy
website}; A table summarizing key aspects of the affiliated packages is included
in the Appendix below (Table~\ref{tab:affiliated-registry}).

Since \paperii, there has been an expansion of affiliated
packages for gravitational astrophysics, including:
\texttt{PyCBC} for exploring gravitational wave signals, \texttt{lenstronomy} for
modeling strong gravitational lenses, \texttt{ligo.skymap} for visualizing
gravitational wave probability maps, and \texttt{EinsteinPy} for general
relativity and gravitational astronomy. There have also been several packages
added to the ecosystem related to HEALPix: \texttt{astropy-healpix}
for a BSD-licensed HEALPix implementation, and \texttt{mocpy} for Multi-Order
Coverage maps. \texttt{astroalign} has been introduced for astrometric registration,
and \texttt{python-cpl} has been added for ESO pipelines and VLT data products.
For ground-based astronomy, \texttt{baseband} has added IO capabilities for
VLBI, and \texttt{SpectraPy} brings slit spectroscopy to the \astropy ecosystem.
Other new affiliated packages include \texttt{agnpy} for AGN jets,
\texttt{statmorph} for fitting galactic morphological diagnostics,
\texttt{dust\_extinction} for modeling interstellar dust extinction,
\texttt{feets} for extracting features from time series data, and
\texttt{corral} for managing data intensive parallel pipelines.
\texttt{saba} gives an interface to the Sherpa \citep{sherpa} fitting routines,
\texttt{BayesicFitting} provides an interface for generic Bayesian inference,
and \texttt{sbpy} enables calculations for asteroid and
cometary astrophysics. Finally, \texttt{synphot} provides an interface for
synthetic photometry.
% \citep{Mommert2019}

Several of the coordinated and affiliated packages described in
\cite{astropy:2018} have had substantial improvements. \texttt{astroquery}
\citep{astroquery} has added access to roughly a dozen new missions and data
services, including the James Webb Space Telescope (JWST) archive, and the
project has switched to a continuous release model: Every time a change is
committed to the main development branch it is published on the Python Package
Index (PyPI) and available for installation. (However, formal releases are still
done a few times per year.) \texttt{photutils} \cite {photutils} released its
first stable version, indicating that the API will change less frequently, and
there have been several significant performance improvements. \texttt{ccdproc}
\cite{ccdproc} also released a new major version, bringing better performance to
some image combination operations. The \texttt{regions} package
\cite{pyregions}, for manipulating ds9-style region definitions \cite{ds9},
added new ways to manipulate regions and introduced new region types.
\texttt{reproject}'s \cite{reproject} major new feature is a function to align
and co-add images to create a mosaic; better support for parallelization was
also added. \texttt{specutils}, the package that defines containers for 1D and
2D spectra \cite{specutils}, also had its first stable release and the addition
of classes to read JWST data. \texttt{stingray} has also had a major performance
overhaul. The package \texttt{gammapy} \cite{gammapy} also has major performance
improvements and has unified its API in preparation for its first stable
release.

\subsection{Connections with data archives}
\label{sec:astroquery}

% \secauthor{Adam Ginsburg}

\texttt{astroquery} \citep{Ginsburg2019} is the Astropy-coordinated package for
interacting with online archives of astronomical and related data. It contains
over 50 modules for querying astronomical databases, large and small. In
particular, since \paperii, significant contributions to \texttt{astroquery}
have come from several of the major archives, including the European Space
Agency (ESA), the Mikulski Archive for Space Telescopes (MAST) at the Space
Telescope Science Institute (STScI), the Infrared Science Archive at the NASA
Infrared Processing and Analysis Center (IRSA at NASA IPAC), the Canadian
Astronomical Data Center (CADC), and the Atacama Large Millimeter/Submillimeter
Array archive (ALMA). These contributions represent a formal acknowledgement of
the utility of a centralized tool suite for archive interaction from \python.
The widespread usage of \texttt{astroquery} is apparent from the range of
keywords represented in the journal articles that cite the \texttt{astroquery}
paper \citep{Ginsburg2019}; everything from asteroids to galaxies is
represented. Additionally \texttt{astroquery} functionality has been built into
several special-purpose \python packages, such as \texttt{LightKurve}
\citep{LightKurve} and SORA \citep{SORA}]. More than 4,000 repositories on
\github make use of \texttt{astroquery} in some way, and \texttt{astroquery}
features in a large number of tutorials on various facets of astronomical
analysis.

Many of the existing and newly-contributed tools rely on Virtual Observatory
(VO) tools. These use the underlying package \texttt{pyvo}, which has also
recently become an Astropy-coordinated package. While many or all of the
functions provided in \texttt{astroquery} can be achieved through direct use of
VO tools implemented in \texttt{pyvo}, the \texttt{astroquery} interfaces more
closely resemble the web interfaces that are more familiar to most users.

\subsection{Connections with Observatories and Missions}

In this section, we highlight a few efforts in observatory- or mission-driven
development that have contributed to Astropy, and vice versa.

\subsubsection{James Webb Space Telescope}
% \secauthor{Larry Bradley}

The James Webb Space Telescope (JWST) is a 6.5-meter space-based
infrared telescope that will provide unprecedented resolution and
sensitivity from 0.6--28 microns. JWST will enable a broad range
of scientific investigations from exoplanets and their atmospheres
to the formation of galaxies in the very early universe. Its four
key scientific goals are to study the first light from stars and
galaxies, the assembly and evolution of galaxies, the birth of stars and
protoplanetary systems, and planetary systems and the origins of life.

The telescope launched on an Ariane 5 rocket on 2021 December 25 from
Kourou, French Guiana. After a series of successful deployments,
including the sunshield and primary and secondary mirrors, JWST reached
its orbit around the L2 Lagrange point on 2022 January 24. Commissioning
of the telescope optics and science instruments will occur from January
until the end of June 2022, when science operations are scheduled to
begin.

Software developers at the Space Telescope Science Institute (STScI),
the operations center of JWST, have been developing \python-based tools
for JWST since 2010 (starting with the JWST Calibration Reference Data
System) and have provided major contributions to \astropy from its
inception. The JWST instrument calibration pipelines, exposure-time
calculators, and data analysis tools are all written in Python and
depend on the \astropypkg core package and some coordinated and
affiliated packages. For the \astropypkg core package, the JWST mission
has provided extensive contributions to the \astropysubpkg{modeling},
\astropysubpkg{units}, \astropysubpkg{coordinates}, \astropysubpkg{wcs},
\astropysubpkg{io.fits}, \astropysubpkg{io.votable},
\astropysubpkg{stats}, \astropysubpkg{visualization}, and
\astropysubpkg{convolution} subpackages as well as to the general
package infrastructure and maintenance.

Likewise, JWST developers have provided significant contributions
to the \package{photutils} \citep{photutils}, \package{specutils}
\citep{specutils}, and \package{regions} \citep{regions} coordinated
packages and the \package{gwcs} \citep{gwcs} and \package{synphot}
\citep{synphot} affiliated packages. For example, development of the
\package{photutils} coordinated package for source detection and
photometry has largely been led by JWST contributions. JWST developers
have also made significant contributions to the \package{specutils}
coordinated package, which is used for analyzing spectroscopic data,
and the \package{regions} coordinated package, which is used to
handle geometric regions. The \package{gwcs} affiliated package for
generalized world coordinate systems was created specifically to handle
the complex world coordinate systems needed for JWST spectroscopic
data. The \package{synphot} affiliated package for synthetic photometry
was created at STScI and is a dependency of the JWST exposure-time
calculators. Further, the \package{ASDF} (Advanced Scientific Data
Format) package \citep{ASDF}, a next-generation interchange format for
scientific data, was initially developed at STScI to serialize JWST WCS
objects along with \astropypkg models, units, and coordinates. Over
its mission lifetime, JWST will continue its support in developing and
maintaining these critically dependent packages.


% Gemini
% \secunfilled

\subsubsection{Cherenkov Telescope Array}
% \secauthor{Axel Donath, Maximilian Nöthe}

The Cherenkov Telescope (CTA) will be the next generation very-high-energy
gamma-ray observatory.
CTA will improve over the current generation of imaging atmospheric Cherenkov telescopes (IACTs)
by a factor of five to ten in sensitivity and will be able to observe the whole sky from a combination of two sites:
a northern site in La Palma, Spain, and a southern one in Paranal, Chile.
CTA will be able to observe gamma rays in a broad energy range from around $20\,\mathrm{GeV}$ to over $300\,\mathrm{TeV}$
using three different types of telescopes, in total over 100 telescopes are planned at the two sites.
CTA will also be the first open gamma-ray observatory.

The data analysis pipeline is developed as open source software and essentially split in two domains:
\begin{enumerate}
  \item In the low-level analysis, the properties of the recorded air-shower events
    have to be estimated from the raw data.
    The raw data consists of very short (\textasciitilde $40--100\,\mathrm{ns}$) videos recorded with the fast and
    sensitive cameras of the telescopes.
    This includes the energy, particle type and direction of origin of the particle that induced the air shower
    and the time the shower was recorded.
  \item In the higher-level analysis, these reconstructed event lists are used together with some
    characterization of the instrument response to perform the actual scientific analysis.
    This software will be delivered as CTA science tools to the future users of the Observatory.
\end{enumerate}

A prototype for the low-level analysis is \texttt{ctapipe} \citep{ctapipe},
a python package developed to perform all the necessary tasks to from the raw data
of Cherenkov telescopes to the reconstructed event lists.
The high-level analysis (or CTA science tools) will be based on the Astropy affiliated package
Gammapy~\citep{gammapy}.
Both Gammapy and \texttt{ctapipe} make heavy use of the \astropy core package, mainly for units, times, coordinate transformations,
tables and FITS I/O.
As CTA will record gamma-ray events with a rate of up to $10\,000$ events per second,
it needs to perform a large number of coordinate transformations.
To enable this, CTA member M.~Nöthe contributed a major performance improvement
for large numbers of coordinates with different observation times,
based on earlier work by B.~Winkel.
Together with Gammapy maintainer A.~Donath and former maintainer C.~Deil,
a total of 107 merged pull requests were contributed to astropy.

\subsubsection{Data Central and the Anglo-Australian Telescope Archive}
% \secauthor{James Tocknell}
Data Central is one of the five Australian Virtual Observatory\footnote{known as
  the All-Sky Virtual Observatory, or ASVO} nodes, providing both Australian and
international astronomers access to and services for surveys of the southern
sky. Whilst primarily hosting optical data, including the Anglo-Australian
Telescope (AAT) Archive\footnote{The AAT Archive is currently jointly managed by
  Data Central, Astronomy Australia Limited (AAL), and National Computational
  Infrastructure (NCI)}, Data Central also assists theoretical and radio
astronomers host and manage their data.

\python is widely used by Data Central, and \astropy and its wider ecosystem
play a vital role in the initial ingestion, reduction, access and visualization
of the hosted data and services. For example, the AAT Archive hosts data back to
1974, so \astropycoordinates, \astropytime and \astropyfits are used to ingest
data flowing from the AAT to ensure that a consistent time and coordinate system
is provided to users for simpler querying.

As many of the surveys hosted by Data Central are spectroscopic surveys from the
AAT, \package{specutils} is heavily used to standardize the variety of encodings
of spectroscopic data into a form easily readable and visualizable by many
standard tools (such as \package{ds9} or \package{splat}). Data Central has
upstreamed into \package{specutils} loaders for all hosted spectra, including
2dfdr-reduced spectra from the AAT Archive, and strongly encourages other
archives to provide loaders for their data to further reuse of existing archival
data.

% Rubin Observatory
% \secunfilled

% LIGO/Virgo/KAGRA
% \secauthor{Leo Singer}

\subsection{Learn Astropy} \label{sec:learn}

\secauthor{Lía Corrales, David Shupe, Kelle Cruz + Learn team}

% \subsubsection{Current status and scope}

\textit{Learn Astropy} is an umbrella term that acknowledges the broad
educational efforts made by the Astropy Project, which are led by the Learn
Team.
The efforts focus on developing online content and workshops covering
astronomy-specific coding tasks in Python.
As introduced in \citet{astropy:2018}, there are four different types of
Learn Astropy content: \textit{tutorials}, consisting of Jupyter Notebook
lessons that are published in HTML format online; \textit{guides}, which are a
series of lessons providing a foundational resource for performing certain
type of astronomical analyses; \textit{examples}, which are snippets of code
that showcase a short task that can be performed with Astropy or an affiliated
package; and \textit{documentation}, which is contained within the code base.
This categorization drives content development, infrastructure choices, and the
appearance of the Learn Astropy website.
The Learn Team meets weekly to work on creating, expanding, improving these
educational resources.

\begin{description}

\item[Learn Astropy website] The Learn Team re-launched the main website and
search interface for Learn Astropy in 2021 with a new infrastructure platform,
built around full-text search and interactive filtering functionality, with the
goal of making content discoverable as the Learn Astropy content catalog
expands.
This work has been supported in part by a grant from the Dunlap Institute.
We have adopted Algolia, a search-as-a-service cloud platform, to store the
full-text and metadata records of Learn Astropy's content.
The new Learn Astropy website is a JavaScript (Gatsby/React) application that
uses the Algolia service to power its search and filtering user interface.
Our Python-based application, Learn Astropy Librarian, populates data into the
Algolia service. We tuned the Librarian around specific content formats (such as
Jupyter Notebook-based tutorial pages and Jupyter Book-based guides) to more
accurately index content and heuristically extract metadata.
A consequence of the new platform is that we now maintain and compile content
separately from the website application itself, enabling new content types.
Tutorials, which are written as Jupyter Notebooks, are now compiled into their
own Learn Astropy sub-site using
\href{https://github.com/astropy/nbcollection}{\texttt{nbcollection}}.
Guides, which utilize the \href{https://jupyterbook.org/}{Jupyter Book} build
infrastructure, are also deployed as separate websites using GitHub pages.
This architecture opens future possibilities of indexing third-party content,
hosted elsewhere, such as on institutional websites.

\item[Tutorials] Currently, we have \# of tutorials, spanning a wide range of astronomical topics and common tasks.

\item[Guides] {\it ccdproc} Jupyter book has been completed.

\item[Workshops] The Project has been conducting workshops at winter
meetings of the American Astronomical Society since AAS 225 in January 2015.
Up to the start of the coronavirus pandemic, these were full-day in-person
workshops with as many as 90 participants and a dozen facilitators from the
project.
During the pandemic, these workshops were moved to an online format and split
into basic and advanced sessions.
Additionally, beginning with the AAS 238 online meeting, the workshops have been
expanded to Summer AAS meetings.
The Learn team finds that the workshop audience is best found as AAS meetings as
opposed to more general Python meetings.

The Astropy Project provided another mode of community engagement at AAS
Meetings 235 and 237 by organizing a NumFOCUS Sponsored Projects booth in the
AAS Exhibit Hall.
Funding for the exhibit hall was provided alternately by NumFOCUS and later by
the Moore Foundation funding (\textbf{check this}).
The booth hosted a series of Q\&A special sessions during AAS 235 and webinars
during the virtual AAS 237 meetings, to provide the general astronomy community
information and access to experts on a variety of open source astronomical
tools.
\end{description}

% \subsubsection{Learn vision for the future}

The Learn plan going forward is to continue to improve the tutorial website and
facilate new content;
to index third-party tutorials; and to look for supportable opportunities to
expand the reach of Astropy workshops beyond the American Astronomical Society
meetings.


\section{Future Plans for the Astropy Project} \label{sec:future}

\subsection{A roadmap for future priorities}
% \secauthor{Clara Brasseur}

The
\href{https://github.com/astropy/astropy-project/blob/main/roadmap/roadmap.md}{Astropy Roadmap} is a document in the \texttt{astropy-project} \github
repository within the \astropy organization that captures high level actionable
items that the Astropy project aims to undertake to improve the health and
stability of the project. It is a static document that is revisited regularly at
the Astropy coordination meetings, intended to keep track of progress and write
new versions as needed. There is a related project board linked to the Roadmap
document that holds specific issues and efforts related to Roadmap items. The
project board is a living document that is continually updated as work is
planned, assigned, and completed.

All items in the Roadmap have been agreed to be priorities for the Astropy
Project, and are color-coded based on resources (both time/effort and
developers/expertise) needed to complete the item. Green items are well
underway, have sufficient resources/support and a plan in place for completion;
For example, efforts to improve the discoverability of documentation and
educational materials by overhauling the Learn website, which is underway (see
Section~\ref{sec:learn}).
Orange items are well defined, and work for acquiring sufficient resources
underway; For example, the goal of providing next-generation spectroscopic
reduction, analysis, and visualization tools usable by individual researchers
and larger surveys.
Red items do not yet have a plan for implementation and need more resources; For
example, the goal of improving interoperability with performant I/O file formats
and libraries such as HDF5 and Dask.
The Astropy Roadmap originates from the March 2021 Astropy Coordination meeting
where it was first drafted before being handed off to a newly formed Astropy
Roadmap working group for completion. The Roadmap in its current form was
adopted via pull request in December 2021.


\subsection{Current and Future Challenges}

Community Engagement

\begin{itemize}
\item {\bf User forums:} The Astropy Project has historically maintained a number of avenues for users to seek help or gain access to the developer community. This includes the Astropy mailing list, the Python in Astronomy Facebook group, and the Astropy Slack workspace. The Moore Foundation grant allows this Slack space to
be on a paid plan; additionally NumFOCUS has negotiated a special rate for
open-source projects. While the Slack and Astropy-dev mailing lists are primarily used to discuss the project direction and updates, it was noted that the use of a Facebook community could present a barrier to open source. The Astropy Project identified a need for a public, archived, searchable, and easily-to-navigate interface for users to ask for help Accordingly, we have commissioned
a Discourse site which is more open than the Facebook group and more user-oriented
than Astropy Slack. A benefit of the Moore Foundation grant is that Astropy
developers are able to invoice as independent contractors the time they
spend helping users on these forums.
\end{itemize}

\begin{itemize}
\item Attracting new contributors when the code has become quite complex,
\item Contributor to maintainer mentoring,
\item Long-term / sustained funding for maintaining infrastructure,
\item ...
\end{itemize}


\begin{acknowledgments}

We would like to thank the members of the community who have contributed to
\astropy, who have opened issues and provided feedback, and have supported the
project in a number of different ways.

The \astropy community is supported by and makes use of a number of
organizations and services outside the traditional academic community.
We thank Google for financing and organizing the
Google Summer of Code (GSoC) program, that has funded severals
students per year to work on \astropy related projects over the
summer. These students often turn into long-term contributors.
We also thank NumFOCUS and the Python Software Foundation for financial
support.
Within the academic community, we thank institutions that make it possible that
astronomers and other developers on their staff can contribute their time to the
development of \astropy projects.
We would like acknowledge the support of the Space Telescope Science Institute,
Harvard--Smithsonian Center for Astrophysics, and the South African Astronomical
Observatory.

Supported by the international Gemini Observatory, a program of NSF's NOIRLab,
which is managed by the Association of Universities for Research in Astronomy
(AURA) under a cooperative agreement with the National Science Foundation, on
behalf of the Gemini partnership of Argentina, Brazil, Canada, Chile, the
Republic of Korea, and the United States of America.

Furthermore, the \astropy packages would not exist in their current form without
a number of web services for code hosting, continuous integration, and
documentation; in particular, \astropy heavily relies on GitHub, Azure
Pipelines, CircleCI, and Read the Docs.

This research has made use of NASA's Astrophysics Data System.

\astropypkg interfaces with the SIMBAD database, operated at CDS, Strasbourg,
France. It also makes use of the ERFA library \citep{erfa}, which in turn
derives from the IAU SOFA Collection\footnote{\url{http://www.iausofa.org}}
developed by the International Astronomical Union Standards of Fundamental
Astronomy \citep{sofa}.

\end{acknowledgments}

\software{\package{astropy} \citep{astropy:2013, astropy:2018},
          \package{numpy} \citep{numpy:nature},
          \package{scipy} \citep{scipy},
          \package{matplotlib} \citep{matplotlib},
          \package{Cython} \citep{cython}.
          % \package{photutils} \citep{photutils},
          % \package{specutils} \citep{specutils},
          % \package{regions} \citep{regions},
          % \package{gwcs} \citep{gwcs},
          % \package{synphot} \citep{synphot},
          % \package{ASDF} \citep{ASDF}.
          % \package{SOFA} \citep{sofa},
          % \package{ERFA} (\citealt{erfa})
          }

\bibliographystyle{aasjournal}
\bibliography{refs, static/affiliated-refs}

\appendix

\section{List of Affiliated Packages}

\begin{longrotatetable}
    \begin{deluxetable*}{ccp{2in}p{2.5in}}
    \tablecaption{Registry of affiliated packages.}
    \label{tab:affiliated-registry}
    \tablehead{
        \colhead{Package Name} &
        % \colhead{Stable} &
        \colhead{PyPI Name} &
        \colhead{Maintainer(s)} &
        \colhead{Citation(s)}
      }
      \startdata
        \input{generated/affiliated-table.tex}
      \enddata
  \end{deluxetable*}
\end{longrotatetable}


\end{document}
